<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:p="http://primefaces.org/ui">

<ui:composition template="_template.xhtml">
	<ui:define name="corpo">
		<h2>Tabular Chamadas</h2>
		<h:form>
			<p:messages autoUpdate="true"/>
			<fieldset>
				<legend>Dados da Chamada</legend>
				<h:panelGrid columns="2">	
								
					<p:outputLabel value="Data da Chamada:" for="dtChamada"/>
					<p:calendar id="dtChamada" value="#{tabulacaoBean.tabulacao.dataChamada.time}"
						pattern="dd/MM/yyyy" mask="true" />
					
					<p:outputLabel value="Período" for="periodo"/>
					<p:selectOneMenu id="periodo" value="#{tabulacaoBean.tabulacao.periodo}">
						<f:selectItem itemLabel="-- Selecione --" noSelectionOption="true"/>
						<f:selectItems value="#{tabulacaoBean.periodos}" />
					</p:selectOneMenu>
					
					<p:outputLabel value="Terminal:" for="terminal"/>
					<p:inputMask id="terminal" value="#{tabulacaoBean.tabulacao.terminal}"
						mask="(99) 9999-9999"/>
					
					<p:outputLabel value="Site:" for="site"/>
					<p:selectOneMenu id="site" value="#{tabulacaoBean.siteSelecionado}">
						<f:selectItem itemLabel="-- Selecione --" noSelectionOption="true"/>
						<f:selectItems value="#{siteBean.sitesAtivos}" var="site"
							itemValue="#{site.id}" itemLabel="#{site.sigla}"/>
					</p:selectOneMenu>
					
					<p:outputLabel value="Rechamada:" for="rechamada"/>
					<p:selectOneMenu id="rechamada" value="#{tabulacaoBean.tabulacao.rechamada}">
						<f:selectItem itemLabel="-- Selecione --" noSelectionOption="true"/>
						<f:selectItems value="#{tabulacaoBean.rechamadas}"/>
					</p:selectOneMenu>
				</h:panelGrid>
			</fieldset>
			<fieldset>	
				<legend>Dados da Tabulação</legend>
				<h:panelGrid columns="2">
					<p:outputLabel value="Produto:" for="produto"/>
						<p:selectOneMenu id="produto" value="#{tabulacaoBean.produtoSelecionado}">
							<f:selectItem itemLabel="-- Selecione --" noSelectionOption="true"/>
							<f:selectItems value="#{produtoBean.produtosAtivos}" var="produto"
								itemValue="#{produto.id}" itemLabel="#{produto.nome}" />
							<p:ajax process="@this" update="motivo"/>
						</p:selectOneMenu>
						
						<p:outputLabel value="Motivo:" for="motivo"/>
						<p:selectOneMenu id="motivo" value="#{tabulacaoBean.motivoSelecionado}">
							<f:selectItem itemLabel="-- Selecione --" noSelectionOption="true"/>
							<f:selectItems value="#{tabulacaoBean.motivos}" var="motivo"
								itemValue="#{motivo}" itemLabel="#{motivo}"/>
							<p:ajax process="@this" update="submotivo"/>
						</p:selectOneMenu>
						
						<p:outputLabel value="Submotivo:" for="submotivo"/>
						<p:selectOneMenu id="submotivo" value="#{tabulacaoBean.subMotivoSelecionado}">
							<f:selectItem itemLabel="-- Selecione -- " noSelectionOption="true"/>
							<f:selectItems value="#{tabulacaoBean.subMotivos}" var="submotivo"
								itemValue="#{submotivo}" itemLabel="#{submotivo}" />
							<p:ajax process="@this" update="detalhe"/>
						</p:selectOneMenu>
						
						<p:outputLabel value="Detalhe:" for="detalhe"/>
						<p:selectOneMenu id="detalhe" value="#{tabulacaoBean.detalheSelecionado}">
							<f:selectItem itemLabel="-- Selecione --" noSelectionOption="true"/>
							<f:selectItems value="#{tabulacaoBean.detalhes}" var="detalhe"
								itemValue="#{detalhe}" itemLabel="#{detalhe}" />
						</p:selectOneMenu>
						
						<p:outputLabel value="Descrição:" for="descricao"/>
						<p:inputTextarea id="descricao" value="#{tabulacaoBean.tabulacao.descricao}" rows="5" cols="35" />
					</h:panelGrid>
					<p:commandButton value="Tabular" action="#{tabulacaoBean.tabula}" icon="ui-icon-check" 
						update="@form :formTabela" />
			</fieldset>
		</h:form>
		
		<!-- TABELA DE TABULAÇÕES-->
		
		<h2>Tabulações</h2>
			
		<h:form id="formTabela">
			<p:dataTable value="#{tabulacaoBean.dataModel}" var="tabulacao"
				paginator="true" rows="20" lazy="true">
				
				<p:column sortBy="#{tabulacao.dataChamada.time}">
					<f:facet name="header">Data da Chamada</f:facet>
					<h:outputText
						value="#{tabulacao.dataChamada.time}" >
						<f:convertDateTime pattern="dd/MM/yyyy"
							timeZone="America/Sao_Paulo" />
					</h:outputText>
				</p:column>
				
				<p:column>
					<f:facet name="header">Período</f:facet>
					#{tabulacao.periodo}			
				</p:column>
								
				<p:column>
					<f:facet name="header">Terminal</f:facet>
					#{tabulacao.terminal}
				</p:column>
				
				<p:column>
					<f:facet name="header">Site</f:facet>
					#{tabulacao.siglaSite}	
				</p:column>
				
				<p:column>
					<f:facet name="header">Rechamada</f:facet>
					#{tabulacao.rechamada}
				</p:column>
				
				<p:column>
					<f:facet name="header">Produto</f:facet>
					#{tabulacao.produto}
				</p:column>
				
				<p:column>
					<f:facet name="header">Motivo</f:facet>
					#{tabulacao.motivo}
				</p:column>
				
				<p:column>
					<f:facet name="header">Submotivo</f:facet>
					#{tabulacao.submotivo}
				</p:column>
				
				<p:column>
					<f:facet name="header">Detalhe</f:facet>
					#{tabulacao.detalhe}
				</p:column>
				
				<p:column>
					<f:facet name="header">Descrição</f:facet>
					#{tabulacao.descricao}
				</p:column>
				
				<p:column>
					<f:facet name="header">Nome do Usuário</f:facet>
					#{tabulacao.nomeUsuario}
				</p:column>
				
				<p:column>
					<f:facet name="header">Data da Tabulacao</f:facet>
					<h:outputText
						value="#{tabulacao.dataTabulacao.time}" >
						<f:convertDateTime pattern="dd/MM/yyyy - HH:mm:ss"
							timeZone="America/Sao_Paulo" />
					</h:outputText>
				</p:column>
			</p:dataTable>
		</h:form>
	</ui:define>
</ui:composition>
</html>